function Setup(){SetAnimFrame();Calculate();CalculateBit();SetNumeric();CalcSweepRadius()}
function Calculate(){isValid=!0;var d=parseCheck("txtRadiusOut","Curve Radius",20,6E3),k=parseCheck("txtWoodThick","Wood Thickness",3,100),w=parseCheck("_txtMinThick","Minimum Thickness must be between 1 and "+k/2+" (1/2 wood thickness)",1,k/2),y=parseCheck("txtAngle","Curve Sweep Degrees",10,180),q=parseCheck("_txtKerfThick","Kerf Width (blade thickness)",.2,6.5);if(isValid){var z=$("rbCurveFromEnds").checked,f=$("cbRouter").checked,m=$("cbColor").checked,n=$("cbDims").checked,t=y*RAD,c=t/2,x=2*
d,C=Math.PI*x/(360/y),G=d*Math.sin(c)*2,F=d-d*Math.cos(c);x=Math.ceil((C-Math.PI*(x-2*k)/(360/y))/q);var b=[],l="",e=$("cnvsKerfProfile");e.width=$("rngScale").value;var h=e.width-2;if(z){var A=x+1;var D=(C+q)/A;var r=D-q;var p=r+q/2;var u=h/C;var g=r*u}else A=x-1,D=C/A,r=D-q,p=0,u=(h-100)/C,g=50-q*u/2;b.push(p);if(r<q)$("spnWontFit").style.display="block";else{$("spnWontFit").style.display="none";var H=q*u,I=H/2,E=w*u,J=D*u,B=k*u;e.height=B+110;var a=e.getContext("2d");a.save();a.translate(.5,60);
a.font="13px Verdana";a.textAlign="left";a.textBaseline="middle";a.beginPath();a.moveTo(0,0);a.lineTo(0,B);var v;for(v=0;v<x;v++)a.lineTo(g,B),f?a.lineTo(g+H/2,E):(a.lineTo(g,E),a.lineTo(g+H,E)),a.lineTo(g+H,B),n&&(a.save(),a.translate(g+H/2,B+10),a.rotate(RAD90),a.fillText(Math.round(p),0,0),a.restore()),l+=Math.round(p)+", ",p+=D,b.push(p),g+=J;a.lineTo(h,B);a.lineTo(h,0);a.closePath();m&&(a.fillStyle=a.createPattern($("imgWood"),"repeat"),a.fill(),a.lineWidth=.5);a.stroke();if(n){g=z?r*u+I:50;
a.fillStyle="#000";a.fillText("\u2190 Start Curve",z?2:g+2,-18);a.textAlign="right";a.fillText("End Curve \u2192",z?h-2:h-g-2,-18);a.beginPath();for(v=0;v<x;v++)a.moveTo(g,B-2),a.lineTo(g,B+4),g+=J;a.stroke();g=z?0:50;a.beginPath();a.moveTo(g,-20);a.lineTo(g,0);g=z?h:g+J*A;a.moveTo(g,-20);a.lineTo(g,0);a.strokeStyle="gray";a.stroke();a.fillStyle="black";a.textAlign="left";a.fillText("Curve Radius "+d+"  -  Sweep Angle "+y+"\u00b0  -  Wood Thick "+k+"  -  Kerf Width "+q,0,-50);a.textAlign="center";
a.fillText("\u2190 "+Math.round(C)+" \u2192",h/2,-12);a.textAlign="right";a.fillText("Printed Scale "+RoundTo(1/(u/(96/25.4)),2)+" : 1",h,-50)}a.restore();$("spnRun").innerHTML=l.TrimEnd(2);$("spnRes").innerHTML=FormatMetric(x+" Cuts of "+q+" mm @ "+RoundTo(D,1)+" mm centres with "+RoundTo(r,1)+" mm wood width between cuts");e=$("cnvsCurve");e.width=$("rngScale").value;h=e.width-40;l=e.width/2;u=h/G;p=d*u;D=p-k*u;w=(k-w)*u;B=F*u+k*Math.cos(c)*u;e.height=B+80;a=e.getContext("2d");a.save();a.translate(.5,
20);t/=A;e=RAD270-c;if($("cbFacet").checked){A=z?x+2:x;g=l+Math.cos(e)*p;E=p+Math.sin(e)*p;a.beginPath();a.moveTo(g,E);for(v=0;v<A;v++)g=l+Math.cos(e)*p,E=p+Math.sin(e)*p,a.lineTo(g,E),e+=t;e-=t;for(v=0;v<A;v++)g=l+Math.cos(e)*D,E=p+Math.sin(e)*D,a.lineTo(g,E),e-=t}else a.beginPath(),a.arc(l,p,p,RAD270-c,RAD270+c,!1),a.arc(l,p,D,RAD270+c,RAD270-c,!0);a.closePath();m&&(a.fillStyle=a.createPattern($("imgWood"),"repeat"),a.fill());a.stroke();e=RAD270-c;z&&(e+=t);a.fillStyle="#fff";a.font="9px Verdana";
a.textAlign="center";a.textBaseline="middle";for(v=0;v<x;v++)g=Math.cos(e)*D+l,E=Math.sin(e)*D+p,a.save(),a.translate(g,E),a.rotate(RAD90+e),a.beginPath(),a.moveTo(0,-1),f?(a.lineTo(0,-w),a.lineWidth=1):(a.lineTo(-I,-w),a.lineTo(I,-w),a.lineTo(0,0),m&&a.fill()),a.lineWidth=.5,a.stroke(),n&&(a.fillStyle="#000",a.fillText(v+1,0,10)),a.restore(),e+=t;n&&(a.strokeStyle="Gray",a.beginPath(),a.moveTo(20,B+10),a.lineTo(20,B+30),a.lineTo(h+20,B+30),a.lineTo(h+20,B+10),a.moveTo(16,F*u),a.lineTo(0,F*u),a.lineTo(0,
0),a.lineTo(16,0),a.stroke(),a.font="13px Verdana",a.textAlign="right",a.fillStyle="#000",a.fillText("Printed Scale "+RoundTo(1/(u/(96/25.4)),2)+" : 1",h,-6),a.textAlign="center",a.fillText(Math.round(C)+" Arc Length   (Outside)",l,-8),a.fillText("\u2190 "+Math.round(G)+" \u2192",l,B+24),a.fillText("Curve Radius "+d+"  -  Sweep Angle "+y+"\u00b0  -  Wood Thick "+k+"  -  Kerf Width "+q,l,B+50),a.save(),a.translate(6,F*u/2),a.rotate(RAD90),a.fillText("\u2190 "+Math.round(F)+" \u2192",0,0),a.restore());
a.restore();z&&b.unshift(0);u=96/25.4;e=$("cnvsTemplate");h=parseFloat($("rngScale").value);e.width=h;a=e.getContext("2d");a.font="13px Verdana";a.textBaseline="middle";a.strokeRect(0,0,e.width,e.height-34.5);a.fillStyle="#000";g=10;E=16;a.strokeStyle="#000";a.beginPath();for(v=0;g<h-4&&v<b.length-1;)a.moveTo(g,0),a.lineTo(g,E),a.save(),a.translate(g,E+10),a.rotate(RAD90),a.fillText(Math.round(b[v]),0,0),a.restore(),g=10+b[v+1]*u,v++;a.stroke();a.textAlign="center";a.fillText("Print and cut this Full Scale Template to mark out Kerf Cut Centres (repeat if short)     Printed Scale 1 : 1",
h/2,e.height-20);$("rngAngle").value=y;$("rngRadius").value=d;$("rngCutThick").value=q}}}function rngAngle_change(d){$("txtAngle").value=d.value;CallAnim()}function rngRadius_change(d){$("txtRadiusOut").value=d.value;CallAnim()}function rngCutThick_change(d){$("_txtKerfThick").value=d.value;CallAnim()}function CallAnim(){requestAnimFrame(function(){Calculate()})}
function CalculateBit(){isValid=!0;var d=parseCheck("_txtBitAngle","Bit Angle",2,15),k=parseCheck("_txtDiam","Shank Diameter",3,16),w=parseCheck("_txtTipDiam","Tip Diameter",.1,1.5),y=parseCheck("_txtWoodThick2","Wood Thickness",4,60),q=parseCheck("_txtMinThick2","Min Thickness",.5,25);if(isValid){var z=$("cbBitClr").checked,f=$("cbFullScale").checked,m=$("cbDimsBit").checked,n=$("rbBallTip").checked,t=d*RAD,c=k/2,x=(c-w/2)/Math.tan(t),C=y-q;n&&(C-=w/2);var G=!1,F=w+C*Math.tan(t)*2;F>k&&(F=k,G=!0);
var b=$("cnvsBit");if(f){var l=96/25.4;f=k*l}else f=parseFloat($("rngScale2").value),l=f/k;c*=l;var e=q*l,h=14*l,A=y*l,D=C*l;C=w*l;var r=14+x+q;n&&(r+=w/2);r*=l;var p=x*l;x=Math.tan(t)*x*l;b.width=f+500;b.height=20+h+p+e+30;b=b.getContext("2d");b.save();b.translate(250.5,20.5);b.beginPath();b.moveTo(-220,r);b.lineTo(f+220,r);b.lineTo(f+220,r-A);b.lineTo(-220,r-A);b.closePath();b.fillStyle=z?b.createPattern($("imgWood"),"repeat"):"#fff";b.fill();b.stroke();b.beginPath();b.moveTo(0,0);b.lineTo(0,h);
b.lineTo(x,h+p);n?b.arc(c,h+p,C/2,RAD180,0,!0):b.lineTo(f-x,h+p);b.lineTo(f,h);b.lineTo(f,0);b.closePath();z?(n=b.createLinearGradient(0,0,k*l,0),n.addColorStop(0,"silver"),n.addColorStop(.5,"white"),n.addColorStop(1,"silver"),b.fillStyle=n):b.fillStyle="#fff";b.fill();b.strokeStyle=z?"silver":"#000";b.stroke();b.beginPath();b.moveTo(0,h);b.lineTo(f,h);b.strokeStlye="Gray";b.stroke();m&&(b.beginPath(),b.moveTo(-240,r),b.lineTo(-220,r),b.moveTo(-240,r-A),b.lineTo(-220,r-A),b.moveTo(0,-20),b.lineTo(0,
0),b.moveTo(f,-20),b.lineTo(f,0),b.strokeStyle="silver",b.stroke(),m=MinMax(f/4,8,12),b.font=m+"px Verdana",b.textAlign="center",b.textBaseline="middle",b.fillStyle="#000",b.fillText("\u2190"+k+"\u2192",f/2,-m),b.save(),b.translate(-220-m,r-A/2),b.rotate(RAD90),b.fillText("\u2190"+y+"\u2192",0,0),b.restore(),b.save(),b.translate(m/2+1,h+4),b.rotate(RAD90-t),b.textAlign="left",b.fillText(d+"\u00b0",0,0),b.restore(),b.textAlign="left",G||(t=c+C/2+Math.tan(t)*D+3,b.fillText("\u2190"+RoundTo(F,2)+" Kerf Width",
t,r-A-m/2)),b.fillStyle=z?"#fff":"#000",b.fillText("\u2195 "+q,c,r-e/2),b.fillText("\u2190 "+w,c+C/2+2,r-e),G&&(b.fillStyle="#f00",b.textAlign="right",b.fillText("TOO DEEP !",-10,r-A-m)));b.restore();$("spnKerfWidth").innerHTML=RoundTo(F,2);$("rngDiam").value=k;$("rngBitAngle").value=d;$("rngTipDiam").value=w;$("rngMinThick2").value=q;$("rngWoodThick2").value=y}}function rngDiam_change(d){$("_txtDiam").value=d.value;CallAnimBit()}
function rngTipDiam_change(d){$("_txtTipDiam").value=d.value;CallAnimBit()}function rngBitAngle_change(d){$("_txtBitAngle").value=d.value;CallAnimBit()}function rngWoodThick2_change(d){$("_txtWoodThick2").value=d.value;CallAnimBit()}function rngMinThick2_change(d){$("_txtMinThick2").value=d.value;CallAnimBit()}function SetTip(d){$("spnTipType").innerHTML="ball"===d?"Diameter":"Width";CalculateBit()}
function cbFullScale_click(d){$("spnScale").style.visibility=d.checked?"hidden":"visible";CalculateBit()}function CallAnimBit(){requestAnimFrame(function(){CalculateBit()})}var arcRat,arcWidth,arcHeight,isLockAngle=!1;
function CalcSweepRadius(){isValid=!0;arcWidth=parseCheck("txtWidth","Curve Width",100,1E3);var d=parseFloat(arcWidth/2);$("txtHeight").value>d&&($("txtHeight").value=d);isLockAngle?(arcHeight=arcWidth*arcRat,$("txtHeight").value=Math.round(arcHeight)):arcHeight=parseCheck("txtHeight","Curve Height",.1,d);if(isValid){$("rngHeight").max=d-1;$("rngHeight").value=arcHeight;$("rngWidth").value=arcWidth;var k=arcWidth/2;d=(Math.pow(k,2)+Math.pow(arcHeight,2))/(2*arcHeight);k=2*Math.asin(k/d);var w=k/RAD,
y=RAD270,q=y-k/2;y+=k/2;var z=2*Math.PI*d/(360/w),f=arcWidth>d?340/arcWidth:340/d,m=arcWidth*f,n=d*f,t=arcWidth*f,c=$("cnvsSweepRad");c.width=m+20;c.height=n+30;m/=2;f*=d;c=c.getContext("2d");c.save();c.translate(10.5,20.5);c.font="10px Verdana";c.textAlign="center";t/=2;n=f*Math.sin(y)+f;c.beginPath();c.arc(m,f,f,q,y,!1);c.arc(m,f,f-10,y,q,!0);c.closePath();c.fillStyle=c.createPattern($("imgWood"),"repeat");c.fill();c.strokeStyle="silver";c.stroke();c.beginPath();c.moveTo(-10,0);c.lineTo(m,0);c.moveTo(-10,
n);c.lineTo(0,n);c.stroke();c.save();c.textBaseline="top";c.translate(-1,n/2);c.rotate(RAD90);c.fillStyle="#f00";c.fillText("\u2190"+Math.round(arcHeight)+"\u2192",0,0);c.restore();c.textBaseline="top";c.fillStyle="#f00";c.fillText("\u2190 "+Math.round(arcWidth)+" \u2192",m,n+1);c.fillStyle="#000";c.beginPath();c.moveTo(m-t,n);c.lineTo(m+t,n);c.lineTo(m,f);c.closePath();c.stroke();t=f/2*Math.cos(q)+m;n=f/2*Math.sin(q)+f;c.save();c.translate(t,n);c.rotate(RAD90-k/2);c.fillText("\u2190 "+Math.round(d)+
" \u2192",0,2);c.restore();c.save();c.translate(m,f-6/Math.tan(k/2));c.rotate(RAD90);c.textBaseline="middle";c.textAlign="right";c.fillText(Math.round(w)+"\u00b0",0,0);c.restore();c.restore();$("spnSweepRadRes").innerHTML=FormatMetric("Radius "+Math.round(d)+" - Sweep Angle "+Math.round(w)+"&deg; -  Curve Length "+Math.round(z))}}function LockAngle(d){isLockAngle=d.checked;$("txtHeight").disabled=$("rngHeight").disabled=isLockAngle;arcRat=arcHeight/arcWidth;CalcSweepRadius()}
function rngWidth_change(d){$("txtWidth").value=d.value;CallAnimSweepRadius()}function rngHeight_change(d){$("txtHeight").value=d.value;CallAnimSweepRadius()}function CallAnimSweepRadius(){requestAnimFrame(function(){CalcSweepRadius()})};
