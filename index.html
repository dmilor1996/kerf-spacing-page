<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kerf Spacing Calculator - Simplified</title>
  <!-- Use the original Blocklayer CSS for basic styling -->
  <link rel="stylesheet" href="assets/www.blocklayer.com/css/bl4.css">
  <style>
    body { font-family: Verdana, Arial, sans-serif; margin: 20px; }
    .calculator {
      display: flex;
      flex-wrap: wrap;
      gap: 40px;
    }
    .calc-form {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 6px;
      width: 320px;
      background-color: #f9f9f9;
    }
    .calc-form label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .calc-form input[type="number"] {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
      margin-top: 4px;
    }
    .calc-form input[type="checkbox"] {
      margin-right: 6px;
    }
    .calc-form button {
      margin-top: 12px;
      padding: 8px 14px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background-color: #0078d4;
      color: white;
      cursor: pointer;
    }
    .calc-form button:hover {
      background-color: #005fb8;
    }
    .results {
      flex: 1;
      min-width: 280px;
      max-width: 450px;
    }
    .results h3 {
      margin-top: 0;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Kerf Spacing Calculator for Bending Wood</h1>
  <div class="calculator">
    <div class="calc-form">
      <label>
        Curve Radius (outside) (mm)
        <input type="number" id="radius" step="0.1" min="1" value="300">
      </label>
      <label>
        Curve Sweep Angle (degrees)
        <input type="number" id="angle" step="0.1" min="1" max="360" value="90">
      </label>
      <label>
        Kerf Width (blade thickness) (mm)
        <input type="number" id="kerf" step="0.01" min="0.1" value="2">
      </label>
      <label>
        Wood Thickness (mm)
        <input type="number" id="thickness" step="0.1" min="1" value="20">
      </label>
      <label>
        Minimum Thickness (mm)
        <input type="number" id="minThick" step="0.1" min="0.1" value="3">
      </label>
      <label>
        <input type="checkbox" id="curveFromEnds">
        Cuts start from board ends
      </label>
      <button id="calculate" type="button">Calculate</button>
      <p id="error" class="error"></p>
    </div>
    <div class="results" id="results">
      <h3>Results</h3>
      <p>Enter values and click <strong>Calculate</strong> to see the kerf spacing results.</p>
    </div>
  </div>
      <!-- Diagram sections: straight and curved representations. Each canvas illustrates the kerf spacing in two different views.
           The first canvas shows a straight (top) view of the board with vertical cut lines and numbering.
           The second canvas shows a curved view of the board with radial cuts and wedge-shaped kerfs. -->
      <div style="margin-top: 30px;" id="diagramContainer">
        <canvas id="straightDiagram" width="800" height="160" style="border:1px solid #ccc; width:100%; max-width:100%; display:block;"></canvas>
        <p style="font-size: 12px; color: #555; margin-top: 4px;">Straight representation: vertical lines denote kerf cuts. Numbers indicate the cut sequence.</p>
        <canvas id="curvedDiagram" width="800" height="300" style="border:1px solid #ccc; width:100%; max-width:100%; display:block;"></canvas>
        <p style="font-size: 12px; color: #555; margin-top: 4px;">Curved representation: the board is bent into an arc; wedge shapes depict the kerf cuts.</p>
      </div>
  <script>
    function calculate() {
      const radius = parseFloat(document.getElementById('radius').value);
      const angle = parseFloat(document.getElementById('angle').value);
      const kerf = parseFloat(document.getElementById('kerf').value);
      const thickness = parseFloat(document.getElementById('thickness').value);
      const minThick = parseFloat(document.getElementById('minThick').value);
      const curveFromEnds = document.getElementById('curveFromEnds').checked;
      const errorElem = document.getElementById('error');
      const resultsElem = document.getElementById('results');
      errorElem.textContent = '';
      resultsElem.innerHTML = '<h3>Results</h3>';
      // Validate inputs
      if (isNaN(radius) || radius <= 0) { errorElem.textContent = 'Please enter a valid curve radius.'; return; }
      if (isNaN(angle) || angle <= 0 || angle > 360) { errorElem.textContent = 'Please enter a sweep angle between 0 and 360 degrees.'; return; }
      if (isNaN(kerf) || kerf <= 0) { errorElem.textContent = 'Please enter a valid kerf width.'; return; }
      if (isNaN(thickness) || thickness <= 0) { errorElem.textContent = 'Please enter a valid wood thickness.'; return; }
      if (isNaN(minThick) || minThick <= 0 || minThick >= thickness/2) { errorElem.textContent = 'Minimum thickness must be positive and less than half the wood thickness.'; return; }
      // Convert angle to radians for calculations
      const C = Math.PI * radius * angle / 180; // arc length of outside curve
      // Number of cuts (ceil of ratio of total compression needed over kerf width)
      const cuts = Math.ceil((Math.PI * angle * thickness / 180) / kerf);
      let D, r;
      if (curveFromEnds) {
        const A = cuts + 1;
        D = (C + kerf) / A;
        r = D - kerf;
      } else {
        const A = cuts - 1;
        D = C / A;
        r = D - kerf;
      }
      // Show results
      const resultStr = `${cuts} cuts of ${kerf.toFixed(2)} mm @ ${D.toFixed(1)} mm centres with ${r.toFixed(1)} mm wood width between cuts.`;
      resultsElem.innerHTML += `<p><strong>${resultStr}</strong></p>`;

          // Draw dynamic diagrams illustrating cut positions in straight and curved views
          drawStraightDiagram(radius, angle, kerf, thickness, minThick, cuts, curveFromEnds, D);
          drawCurvedDiagram(radius, angle, kerf, thickness, minThick, cuts, curveFromEnds, D);
    }
// Ensure clicking the button doesn't submit a form or reload the page
document.getElementById('calculate').addEventListener('click', function(e) {
      e.preventDefault();
      calculate();
    });

    /**
     * Draw the straight (top view) diagram of kerf cuts on a board.
     * This draws a horizontal board with vertical lines indicating cuts and labels each cut.
     *
     * @param {number} radius - Curve radius in millimetres.
     * @param {number} angle - Sweep angle in degrees.
     * @param {number} kerf - Kerf width (blade thickness) in millimetres.
     * @param {number} thickness - Board thickness in millimetres.
     * @param {number} minThick - Minimum remaining thickness after cut (mm).
     * @param {number} cuts - Number of cuts.
     * @param {boolean} curveFromEnds - True if kerfs start from board ends.
     * @param {number} D - Centre spacing between cut centres (mm).
     */
    function drawStraightDiagram(radius, angle, kerf, thickness, minThick, cuts, curveFromEnds, D) {
      const canvas = document.getElementById('straightDiagram');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Compute total arc length for scaling
      const C = Math.PI * radius * angle / 180;
      // Margins and dimensions
      const marginX = 40;
      const boardWidthPx = canvas.width - 2 * marginX;
      const boardTopPx = 40;
      const boardHeightPx = 50;
      const boardBottomPx = boardTopPx + boardHeightPx;
      // Scale mm to pixels along board length
      const scale = boardWidthPx / C;

      // Draw the board background.  Use a white fill and a crisp black outline
      // so the board stands out clearly.  A slightly thicker outline helps
      // differentiate the board from the kerf shading.
      ctx.fillStyle = '#ffffff';
      ctx.strokeStyle = '#000000';
      ctx.lineWidth = 1.5;
      ctx.fillRect(marginX, boardTopPx, boardWidthPx, boardHeightPx);
      ctx.strokeRect(marginX, boardTopPx, boardWidthPx, boardHeightPx);

      // Compute kerf cut depth ratio for shading
      const cutDepthMm = thickness - minThick;
      const cutDepthRatio = cutDepthMm / thickness;
      const cutDepthPx = boardHeightPx * cutDepthRatio;
      // Shade the region that is removed by kerfs (kerf depth).  Use a
      // mid‑tone grey so it contrasts clearly against the white board.
      ctx.fillStyle = '#dddddd';
      ctx.fillRect(marginX, boardTopPx, boardWidthPx, cutDepthPx);

      // Draw each cut as a line and shade the kerf
      // Draw each kerf as a shaded rectangle with a dark outline.  Use a
      // slightly darker grey than the kerf depth shading so individual kerfs
      // stand out.  The stroke is solid black for maximum contrast.
      ctx.strokeStyle = '#000000';
      ctx.fillStyle = '#bbbbbb';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.font = '12px Arial';
      for (let i = 0; i < cuts; i++) {
        let dist;
        if (curveFromEnds) {
          dist = D / 2 + i * D;
        } else {
          dist = i * D;
        }
        if (dist > C) continue;
        const xCenterPx = marginX + dist * scale;
        const kerfPx = kerf * scale;
        // Shade the kerf gap (top portion only).  Draw before the kerf line so
        // the line sits on top of the shading.  The fill colour has been set
        // above.
        ctx.fillRect(xCenterPx - kerfPx / 2, boardTopPx, kerfPx, cutDepthPx);
        // Draw the cut line
        ctx.beginPath();
        ctx.moveTo(xCenterPx, boardTopPx);
        ctx.lineTo(xCenterPx, boardBottomPx);
        ctx.stroke();
        // Label cuts (1-based)
        const labelY = boardBottomPx + 8;
        ctx.fillStyle = '#000';
        ctx.fillText((i + 1).toString(), xCenterPx, labelY);
      }
      // Optionally draw border for numbering baseline
    }

    /**
     * Draw the curved view diagram of kerf cuts on a board.
     * This renders a curved board segment with radial cut lines and wedge-shaped kerfs.
     *
     * @param {number} radius - Curve radius (mm).
     * @param {number} angle - Sweep angle (degrees).
     * @param {number} kerf - Kerf width (mm).
     * @param {number} thickness - Board thickness (mm).
     * @param {number} minThick - Minimum remaining thickness after kerf (mm).
     * @param {number} cuts - Number of cuts.
     * @param {boolean} curveFromEnds - Whether kerfs start from board ends.
     * @param {number} D - Centre spacing (mm).
     */
    function drawCurvedDiagram(radius, angle, kerf, thickness, minThick, cuts, curveFromEnds, D) {
      const canvas = document.getElementById('curvedDiagram');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Convert angle to radians and compute total angle
      const totalAngleRad = angle * Math.PI / 180;
      // Determine start and end angles in canvas coordinates.
      // We draw the board concave downward (top of circle) using a clockwise arc from start to end.
      const half = totalAngleRad / 2;
      const startAngle = Math.PI / 2 + half; // e.g. 90° + half
      const endAngle = Math.PI / 2 - half;   // e.g. 90° - half

      const outerR = radius;
      const innerR = radius - (thickness - minThick);
      // Compute horizontal span in mm to scale into canvas width
           const spanMm = 2 * outerR * Math.sin(half);
           const marginX = 40;
           const marginY = 20;
           const widthPx = canvas.width - 2 * marginX;
           const heightPx = canvas.height - 2 * marginY;
           // Compute scale factors for horizontal and vertical constraints. The board's
           // horizontal span must fit within widthPx and the full outer radius must
           // fit within heightPx. Use the smaller of the two to maintain aspect ratio.
           const widthScale = widthPx / spanMm;
           const heightScale = heightPx / outerR;
           const scale = Math.min(widthScale, heightScale);
           const centerX = canvas.width / 2;
           // Position the centre so the top of the outer arc touches marginY.
           const centerY = marginY + outerR * scale;

      // Draw the board shape: outer arc, radial line, inner arc, radial line
      ctx.beginPath();
      ctx.moveTo(
        centerX + outerR * scale * Math.cos(startAngle),
        centerY + outerR * scale * Math.sin(startAngle)
      );
      ctx.arc(centerX, centerY, outerR * scale, startAngle, endAngle, false);
      // radial line to inner arc at endAngle
      ctx.lineTo(
        centerX + innerR * scale * Math.cos(endAngle),
        centerY + innerR * scale * Math.sin(endAngle)
      );
      // inner arc back to start
      ctx.arc(centerX, centerY, innerR * scale, endAngle, startAngle, true);
      ctx.closePath();
      // Fill and stroke the board segment.  Use a white fill with a
      // solid black outline so the board stands out crisply on the white
      // canvas.  The outline is slightly thicker for better visibility.
      ctx.fillStyle = '#ffffff';
      ctx.strokeStyle = '#000000';
      ctx.lineWidth = 1.5;
      ctx.fill();
      ctx.stroke();

      // Arc length C for positioning
      const C = Math.PI * radius * angle / 180;
      // For each cut, draw wedge and radial line
           // Use a mid‑tone grey for the kerf wedges to contrast with the board
           // segment.  Set a black stroke for maximum contrast.
           ctx.fillStyle = '#cccccc';
           ctx.strokeStyle = '#000000';
      ctx.lineWidth = 1;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.font = '12px Arial';
      for (let i = 0; i < cuts; i++) {
        let dist;
        if (curveFromEnds) {
          dist = D / 2 + i * D;
        } else {
          dist = i * D;
        }
        if (dist > C) continue;
        // Fraction along the arc from start to end
        const frac = dist / C;
        // Compute central angle for the cut on the outer arc
        const theta = startAngle - frac * totalAngleRad;
        // Wedge width at inner radius (kerf mm)
        const angleDelta = kerf / innerR;
        const leftEdge = theta + angleDelta / 2;
        const rightEdge = theta - angleDelta / 2;
        // Apex at inner radius (centre of kerf)
        const apexX = centerX + innerR * scale * Math.cos(theta);
        const apexY = centerY + innerR * scale * Math.sin(theta);
        // Base vertices at outer radius along kerf edges
        const baseRightX = centerX + outerR * scale * Math.cos(rightEdge);
        const baseRightY = centerY + outerR * scale * Math.sin(rightEdge);
        const baseLeftX = centerX + outerR * scale * Math.cos(leftEdge);
        const baseLeftY = centerY + outerR * scale * Math.sin(leftEdge);
        // Draw wedge shape
        ctx.beginPath();
        ctx.moveTo(apexX, apexY);
        ctx.lineTo(baseRightX, baseRightY);
        ctx.lineTo(baseLeftX, baseLeftY);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        // Draw central radial line
        const outX = centerX + outerR * scale * Math.cos(theta);
        const outY = centerY + outerR * scale * Math.sin(theta);
        ctx.beginPath();
        ctx.moveTo(outX, outY);
        ctx.lineTo(apexX, apexY);
        ctx.stroke();
        // Draw cut number on inner arc slightly inward
        const labelRadius = (innerR + outerR) / 2; // place halfway inside board
        const labelX = centerX + labelRadius * scale * Math.cos(theta);
        const labelY = centerY + labelRadius * scale * Math.sin(theta);
             ctx.fillStyle = '#000';
             ctx.fillText((i + 1).toString(), labelX, labelY);
             // Reset fill colour for wedges after drawing the label
             ctx.fillStyle = '#cccccc';
      }
    }

    // The drawDiagram function has been replaced with two more detailed diagram
    // functions defined below: drawStraightDiagram and drawCurvedDiagram.
  </script>
</body>
</html>
